知识点：显示控制
---

IBM PC/AT及其兼容计算机可以使用彩色和单色显示卡。IBM最早推出的PC机视频系统标准有单色MDA标准和彩色CGA标准以及EGA和VGA标准。以后推出的所有高级显示卡（包括现在的 AGP 显示卡）虽然都具有极高的图形处理速度和智能加速处理功能，但它们还是都支持这几种最初的标准。（Linux 0.1x 操作系统仅使用了这几种标准都支持的文本显示方式）

## MDA显示标准

单色显示适配器MDA（Monochrome Display Adapter）仅支持黑白两色显示。并且只支持独有的文本字符显示方式（BIOS 显示方式 7）。其屏幕显示规格是80列x25行（列号0-79；行号0-24），共可显示2000个字符。每个字符还带有1个属性字节，因此显示一屏（一帧）内容需要占4KB字节。其中低位地址字节存放字符代码，高位地址字节存放显示属性。

MDA卡配置有8KB显示内存。在PC机内存寻址范围中占用从0xb0000开始的8KB空间（0xb0000-0xb2000）。
> 如果显示屏行数是 video_num_lines = 25；列数是 video_num_colums = 80，那么位于屏幕列行值 x、y 处的字符和属性在内存中的位置是：字符字节位置 = `0xb0000 + video_num_colums * 2 * y + x * 2`；属性字节位置 = 字符字节位置 + 1；

在MDA单色文本显示方式中，每个字符的属性字节格式见下表所示。其中，D7置1会使字符闪烁；D3置1使字符高亮度显示。它与彩色文本字符的属性字节基本一致，但只有两种颜色：白色（0x111）和黑色（0x000）。

### 单色显示字符属性

| 背景色D6D5D4| 前景色D2D1D0| 属性值无闪低亮| 显示效果 |
| --- | --- | ---- | --- |
| 000 | 000 | 0x00 | 字符不可见 |
| 000 | 111 | 0x07 | 黑色背景上显示白色字符（正常显示） |
| 000 | 001 | 0x01 | 黑色背景上显示白色带下划线字符  |
| 111 | 000 | 0x70 | 白色背景上显示黑色字符（反显） |
| 111 | 111 | 0x77 | 显示白色方块 |


## CGA 显示标准
彩色图形适配器CGA(Color Graphics Adapter)支持7种彩色和图形显示方式（BIOS 显示方式 0-6）。

在80列x25行的文本字符显示方式下，有单色和16色彩色两种显示方式（BIOS显示方式2-3）。CGA卡标配有16KB显示内存（占用内存地址范围0xb8000-0xbc000），因此其中共可存放4帧显示信息。同样，在每一帧4KB显示内存中，低位地址字节存放字符代码，高位地址字节存放字符显示属性。但在console.c程序中只使用了其中8KB显示内存（0xb8000-0xba000）。

在CGA彩色文本显示方式中，每个显示字符的属性字节格式定义见下表所示。

### 字符属性字节
| D7 | D6D5D4 | D3 | D2D1D0 |
| -- | ------ | -- | ------ |
| BL | RGB    | I  | RGB |
| 闪烁 |背景色 | 高亮 |前景色 |

> 对单色显示卡，D0显示为下划线

### 前景色和背景色组合
| IRGB | 值 | 颜色名称 |
| ---- | -- | ---- |
| 0000 | 0x00 | 黑色（Black） |
| 0001 | 0x01 | 蓝色（Blue） |
| 0010 | 0x02 | 绿色（Green） |
| 0011 | 0x03 | 青色（Cyan） |
| 0100 | 0x04 | 红色（Red） |
| 0101 | 0x05 | 品红（Magenta） |
| 0110 | 0x06 | 棕色（Brown） |
| 0111 | 0x07 | 灰白（Light grey） |
| 1000 | 0x08 | 深灰（Dark grey）|
| 1001 | 0x09 | 淡蓝（Light blue） |
| 1010 | 0x0a | 淡绿（Light green） |
| 1011 | 0x0b | 淡青（Light cyan） |
| 1100 | 0x0c | 淡红（Light red） |
| 1101 | 0x0d | 淡品红（Light magenta） |
| 1110 | 0x0e | 黄色（Yellow） |
| 1111 | 0x0f | 白色（White） |


## EGA/VGA显示标准
增强型图形适配器EGA（Enhanced Grpahics Adapter）和视频图形阵列VGA（Video Graphics Adapter）除兼容或支持MDA和CGA的显示方式以外，还支持其他在图形显示方面的增强显示方式。

在与MDA和CGA兼容的显示方式下，占用的内存地址起始位置和范围都分别相同。但EGA/VGA都标配有起码32KB的显示内存。在图形方式下占用从0xa0000开始的物理内存地址空间。

> 本知识点摘录自赵炯老师的《Linux内核完全注释》修正版V5.0，基本覆盖了王爽老师《汇编语言》实验9中编程材料所介绍的知识。实验9是在DOS系统环境下，基本跟上述彩色图形适配器CGA显示标准一致，采用80x25彩色字符模式，需要注意的是在DOS系统中显示缓冲区占用的是从B8000H~BFFFFH的32KB字节（每页4KB，共8页）的存储空间。