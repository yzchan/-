知识点:软盘
---

3.5英寸软盘分为上下两个面，每个面80个磁道，每个磁道18个扇区，每个扇区大小为512字节。

> 软盘的总容量为 `2面*80磁道*18扇区*512字节` = 1440KB（约1.44MB）

磁盘的实际访问由磁盘控制器进行，我们可以通过磁盘控制器来访问磁盘。只能以扇区单位进行磁盘的读写。在读写扇区时要给出面号、磁道号和扇区号。要注意的是面号和磁道号从0还是，扇区号从1开始。

BIOS提供了对磁盘进行读写的中断例程int 13h，该中断完成了许多复杂的硬件相关工作。我们可以通过该中断来访问磁盘。

读取0面0磁道1扇区的内容复制到0:200处的示例程序如下：

```s
mov ax,0
mov es,ax
mov bx,200h ;# es:bx指向接受扇区读入内存数据的内存起始地址

mov al,1    ;# 要读取的扇区数
mov ch,0    ;# 磁道号
mov cl,1    ;# 扇区号
mov dl,0    ;# 驱动器号 软驱从0开始  0:软驱A  1:软驱B  硬盘从80h开始 80h:硬盘C 81h:硬盘D
mov dh,0    ;# 磁头号（低于软盘即面号）
mov ah,2    ;# 2号子程序表示读取  3号子程序表示写入
int 13h
```

入参见上述代码注释

出参：
- 操作成功时：(ah)=0 (al)=读取的扇区数
- 操作失败时：(ah)=出错代码

#### 出口参数：AH＝00H，AL＝状态代码，其定义如下：
| 代码 | 内容 |
| --- | --- |
| 00H | 无错 |
| 01H | 非法命令 |
| 02H | 地址目标未发现 |
| 03H | 磁盘写保护(软盘) |
| 04H | 扇区未发现 |
| 05H | 复位失败(硬盘) |
| 06H | 软盘取出(软盘) |
| 07H | 错误的参数表(硬盘) |
| 08H | DMA越界(软盘) |
| 09H | DMA超过64K界限 |
| 0AH | 错误的扇区标志(硬盘) |
| 0BH | 错误的磁道标志(硬盘) |
| 0CH | 介质类型未发现(软盘) |
| 0DH | 格式化时非法扇区号(硬盘) |
| 0EH | 控制数据地址目标被发现(硬盘) |
| 0FH | DMA仲裁越界(硬盘) |
| 10H | 不正确的CRC或ECC编码 |
| 11H | ECC校正数据错(硬盘)|
|     |  ↑ CRC:Cyclic Redundancy Check code|
|     |  ↑ ECC:Error Checking & Correcting code |
| 20H | 控制器失败 |
| 40H | 查找失败 |
| 80H | 磁盘超时(未响应) |
| AAH | 驱动器未准备好(硬盘) |
| BBH | 未定义的错误(硬盘) |
| CCH | 写错误(硬盘) |
| E0H | 状态寄存器错(硬盘) |
| FFH | 检测操作失败(硬盘) |