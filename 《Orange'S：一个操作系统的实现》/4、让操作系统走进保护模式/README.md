# 让操作系统走进保护模式

本章主要介绍boot loader。首先要了解MBR的机制，简单来说就是开机上电经过自检等一些列步骤之后，CPU会将硬盘（或软盘）中的引导扇区(Boot Sector，通常指设备的第一个扇区）加载到内存0x7c00处，然后jmp过去。

一个扇区只有512字节，如果操作系统足够小巧（不超过512字节）直接把操作系统写在引导扇区内也是可以的。但显然如此小巧的操作系统功能会十分受限。所以可以利用引导扇区做一个加载操作系统的引导程序，把操作系统加载到内存后再转交控制权。

书中介绍的方法比较特别，是利用fat12格式的文件系统存储loader程序，在引导扇区中写一个boot程序找到loader并加载到内存，最后转交控制权。

这种方式跟linux的启动方式有很大不同。实现起来更加复杂，但性质是一样的，都是为了加载操作系统进内存。好处就是fat12格式兼容dos，方便使用bochs仿真freedos进行调试。


## 知识点归纳

1. FAT12文件格式
2. 1.44m软盘知识
3. int13中断

## 函数封装

1. 根据逻辑扇区号来读入扇区数据
2. 在FAT根目录区查找loader所在扇区号
3. 再根据扇区号求FAT项的值

完成上述3个函数的封装，本章内容就基本掌握了。

## 关联知识点

### 启动方式

mbr+leagcy与gpt+uefi启动方式

### 文件系统

常见文件系统FS(File System)

> Windows: fat12/fat16/fat32/exfat/NTFS\
> Linux: ext系列、XFS等（Linux更加开放，因此支持的FS非常的多）\
> MacOS: HFS/HFS+/APFS
